<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>å˜é‡å®šä¹‰ - Cå˜é‡å‘½å</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="app-container">
        <header class="page-header">
            <a href="/" class="back-btn">â†</a>
            <h1>ğŸ“ å˜é‡å®šä¹‰</h1>
        </header>

        <div class="content">
            <div class="card">
                <div class="form-group">
                    <label>å˜é‡ç±»å‹</label>
                    <select id="var-type" class="input-field">
                        <option value="uint8_t">uint8_t (æ— ç¬¦å·8ä½)</option>
                        <option value="int8_t">int8_t (æœ‰ç¬¦å·8ä½)</option>
                        <option value="uint16_t">uint16_t (æ— ç¬¦å·16ä½)</option>
                        <option value="int16_t">int16_t (æœ‰ç¬¦å·16ä½)</option>
                        <option value="uint32_t">uint32_t (æ— ç¬¦å·32ä½)</option>
                        <option value="int32_t">int32_t (æœ‰ç¬¦å·32ä½)</option>
                        <option value="float">float (æµ®ç‚¹å‹)</option>
                        <option value="double">double (åŒç²¾åº¦)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>ä¸­æ–‡åç§°</label>
                    <div class="input-with-button">
                        <input type="text" id="chinese-name" placeholder="ä¾‹å¦‚ï¼šæ¸©åº¦å€¼" class="input-field">
                        <button onclick="translateName()" class="btn-icon">ğŸŒ</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>è‹±æ–‡åç§°</label>
                    <input type="text" id="english-name" placeholder="ä¾‹å¦‚ï¼štemperature" class="input-field">
                </div>

                <div class="form-group">
                    <label>ä½œç”¨åŸŸ</label>
                    <select id="scope" class="input-field">
                        <option value="global">å…¨å±€å˜é‡ (g_)</option>
                        <option value="static">é™æ€å˜é‡ (s_)</option>
                        <option value="local">å±€éƒ¨å˜é‡ (l_)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="is-const">
                        <span>const (å¸¸é‡)</span>
                    </label>
                    <label class="checkbox-label">
                        <input type="checkbox" id="is-volatile">
                        <span>volatile (æ˜“å˜)</span>
                    </label>
                </div>

                <div class="form-group">
                    <label>åˆå§‹å€¼ï¼ˆå¯é€‰ï¼‰</label>
                    <input type="text" id="initial-value" placeholder="ä¾‹å¦‚ï¼š0" class="input-field">
                </div>

                <button onclick="generateVariable()" class="btn-primary btn-block">âš¡ ç”Ÿæˆä»£ç </button>
            </div>

            <div id="result-card" class="card" style="display: none;">
                <h2>ç”Ÿæˆçš„ä»£ç </h2>
                <pre id="generated-code" class="code-block"></pre>
                <button onclick="copyCode()" class="btn-secondary btn-block">ğŸ“‹ å¤åˆ¶ä»£ç </button>
            </div>
        </div>
    </div>

    <script src="/static/js/app.js"></script>
    <script>
        let generatedCode = '';

        async function translateName() {
            const chinese = document.getElementById('chinese-name').value.trim();
            if (!chinese) {
                alert('è¯·å…ˆè¾“å…¥ä¸­æ–‡åç§°');
                return;
            }

            showLoading();
            try {
                const response = await fetch('/api/translate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: chinese })
                });

                const data = await response.json();
                if (data.success) {
                    document.getElementById('english-name').value = data.primary;
                    showToast('ç¿»è¯‘æˆåŠŸ');
                }
            } catch (error) {
                alert('ç¿»è¯‘å¤±è´¥ï¼š' + error.message);
            } finally {
                hideLoading();
            }
        }

        async function generateVariable() {
            const chineseName = document.getElementById('chinese-name').value.trim();
            const englishName = document.getElementById('english-name').value.trim();
            
            if (!englishName) {
                alert('è¯·è¾“å…¥è‹±æ–‡åç§°');
                return;
            }

            showLoading();
            try {
                const response = await fetch('/api/generate/variable', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        type: document.getElementById('var-type').value,
                        chinese_name: chineseName,
                        english_name: englishName,
                        scope: document.getElementById('scope').value,
                        is_const: document.getElementById('is-const').checked,
                        is_volatile: document.getElementById('is-volatile').checked,
                        initial_value: document.getElementById('initial-value').value.trim()
                    })
                });

                const data = await response.json();
                if (data.success) {
                    generatedCode = data.code;
                    document.getElementById('generated-code').textContent = data.code;
                    document.getElementById('result-card').style.display = 'block';
                    showToast('ä»£ç å·²ç”Ÿæˆ');
                    
                    // æ»šåŠ¨åˆ°ç»“æœ
                    document.getElementById('result-card').scrollIntoView({ behavior: 'smooth' });
                } else {
                    alert('ç”Ÿæˆå¤±è´¥ï¼š' + (data.error || 'æœªçŸ¥é”™è¯¯'));
                }
            } catch (error) {
                alert('ç½‘ç»œé”™è¯¯ï¼š' + error.message);
            } finally {
                hideLoading();
            }
        }

        function copyCode() {
            copyToClipboard(generatedCode);
            showToast('ä»£ç å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }
    </script>
</body>
</html>
