<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŒ‡é’ˆå®šä¹‰</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="app-container">
        <header class="page-header">
            <a href="/" class="back-btn">â†</a>
            <h1>ğŸ‘‰ æŒ‡é’ˆå®šä¹‰</h1>
        </header>
        <div class="content">
            <div class="card">
                <div class="form-group">
                    <label>æŒ‡é’ˆç±»å‹</label>
                    <select id="pointer-type" class="input-field">
                        <option value="æ™®é€šæŒ‡é’ˆ">æ™®é€šæŒ‡é’ˆ</option>
                        <option value="å‡½æ•°æŒ‡é’ˆ">å‡½æ•°æŒ‡é’ˆ</option>
                        <option value="æ•°ç»„æŒ‡é’ˆ">æ•°ç»„æŒ‡é’ˆ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>åŸºç¡€ç±»å‹</label>
                    <select id="base-type" class="input-field">
                        <option value="uint8_t">uint8_t</option>
                        <option value="uint16_t">uint16_t</option>
                        <option value="uint32_t">uint32_t</option>
                        <option value="void">void</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ä¸­æ–‡åç§°</label>
                    <div class="input-with-button">
                        <input type="text" id="chinese-name" placeholder="ä¾‹å¦‚ï¼šç¼“å†²åŒºæŒ‡é’ˆ" class="input-field">
                        <button onclick="translateName()" class="btn-icon">ğŸŒ</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>è‹±æ–‡åç§°</label>
                    <input type="text" id="english-name" placeholder="ä¾‹å¦‚ï¼šbuffer" class="input-field">
                </div>
                <div class="form-group">
                    <label>æŒ‡é’ˆçº§åˆ«</label>
                    <select id="level" class="input-field">
                        <option value="1">ä¸€çº§æŒ‡é’ˆ (*)</option>
                        <option value="2">äºŒçº§æŒ‡é’ˆ (**)</option>
                        <option value="3">ä¸‰çº§æŒ‡é’ˆ (***)</option>
                    </select>
                </div>
                <button onclick="generatePointer()" class="btn-primary btn-block">âš¡ ç”Ÿæˆä»£ç </button>
            </div>
            <div id="result-card" class="card" style="display: none;">
                <h2>ç”Ÿæˆçš„ä»£ç </h2>
                <pre id="generated-code" class="code-block"></pre>
                <button onclick="copyCode()" class="btn-secondary btn-block">ğŸ“‹ å¤åˆ¶ä»£ç </button>
            </div>
        </div>
    </div>
    <script src="/static/js/app.js"></script>
    <script>
        let generatedCode = '';
        async function translateName() {
            const chinese = document.getElementById('chinese-name').value.trim();
            if (!chinese) return alert('è¯·å…ˆè¾“å…¥ä¸­æ–‡åç§°');
            showLoading();
            try {
                const resp = await fetch('/api/translate', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({text: chinese})
                });
                const data = await resp.json();
                if (data.success) document.getElementById('english-name').value = data.primary;
            } finally { hideLoading(); }
        }
        async function generatePointer() {
            const english = document.getElementById('english-name').value.trim();
            if (!english) return alert('è¯·è¾“å…¥è‹±æ–‡åç§°');
            showLoading();
            try {
                const resp = await fetch('/api/generate/pointer', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        pointer_type: document.getElementById('pointer-type').value,
                        base_type: document.getElementById('base-type').value,
                        chinese_name: document.getElementById('chinese-name').value,
                        english_name: english,
                        scope: 'global',
                        level: parseInt(document.getElementById('level').value)
                    })
                });
                const data = await resp.json();
                if (data.success) {
                    generatedCode = data.code;
                    document.getElementById('generated-code').textContent = data.code;
                    document.getElementById('result-card').style.display = 'block';
                }
            } finally { hideLoading(); }
        }
        function copyCode() {
            copyToClipboard(generatedCode);
            showToast('ä»£ç å·²å¤åˆ¶');
        }
    </script>
</body>
</html>
